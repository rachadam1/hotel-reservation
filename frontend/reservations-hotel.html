<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>RÃ©servations de lâ€™hÃ´tel</title>
  <style>
    body { font-family: Arial; padding: 40px; background: #f4f8fc; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { padding: 12px; border: 1px solid #ccc; text-align: left; }
    th { background: #007bff; color: white; }
    .btn { padding: 6px 12px; margin-right: 5px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .filtre { margin-bottom: 20px; text-align: center; }
    input[type="date"] { padding: 8px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ðŸ“… RÃ©servations de lâ€™hÃ´tel</h1>

  <div class="filtre">
    <label for="filtreDate">Filtrer par date :</label>
    <input type="date" id="filtreDate" onchange="chargerReservations()">
  </div>

  <table>
    <thead>
      <tr>
        <th>Client</th>
        <th>Chambre</th>
        <th>Type</th>
        <th>ArrivÃ©e</th>
        <th>DÃ©part</th>
        <th>Statut</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="reservationsTableBody"></tbody>
  </table>

  <script>
    const params = new URLSearchParams(window.location.search);
    const hotelId = params.get('id');

    async function chargerReservations() {
      const date = document.getElementById('filtreDate').value;
      let url = `http://localhost:3000/api/reservations?hotel_id=${hotelId}`;
      if (date) url += `&date=${date}`;

      const res = await fetch(url);
      const reservations = await res.json();
      const tbody = document.getElementById('reservationsTableBody');
      tbody.innerHTML = '';

      reservations.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.nom_client}</td>
          <td>${r.numero_chambre}</td>
          <td>${r.type_reservation}</td>
          <td>${r.date_arrivee} ${r.heure_arrivee || ''}</td>
          <td>${r.date_depart} ${r.heure_depart || ''}</td>
          <td>${r.statut_reservation}</td>
          <td>
            <button class="btn" onclick="libererChambre(${r.chambre_id})">ðŸ§¹ LibÃ©rer</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function libererChambre(chambreId) {
      fetch(`http://localhost:3000/api/chambres/${chambreId}/statut`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ statut: 'Ã  nettoyer' })
      }).then(() => chargerReservations());
    }

    chargerReservations();
  </script>
</body>
</html>
